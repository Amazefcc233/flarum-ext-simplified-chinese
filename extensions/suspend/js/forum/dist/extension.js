System.register("suspend/main",["flarum/extend","flarum/app","flarum/utils/UserControls","flarum/components/Button","flarum/components/Badge","flarum/Model","flarum/models/User","suspend/components/SuspendUserModal"],function(t){"use strict";var e,n,a,s,i,o,u,r;return{setters:[function(t){e=t.extend},function(t){n=t["default"]},function(t){a=t["default"]},function(t){s=t["default"]},function(t){i=t["default"]},function(t){o=t["default"]},function(t){u=t["default"]},function(t){r=t["default"]}],execute:function(){n.initializers.add("suspend",function(){u.prototype.canSuspend=o.attribute("canSuspend"),u.prototype.suspendUntil=o.attribute("suspendUntil",o.transformDate),e(a,"moderationControls",function(t,e){e.canSuspend()&&t.add("suspend",s.component({children:"冻结",icon:"shield",onclick:function(){return n.modal.show(new r({user:e}))}}))}),e(u.prototype,"badges",function(t){var e=this.suspendUntil();new Date<e&&t.add("suspended",i.component({icon:"times",type:"suspended",label:"冻结"}))})})}}}),System.register("suspend/components/SuspendUserModal",["flarum/components/Modal","flarum/components/Button"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,s,i,o=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),u=function(t,e,n){for(var a=!0;a;){var s=t,i=e,o=n;u=l=r=void 0,a=!1,null===s&&(s=Function.prototype);var u=Object.getOwnPropertyDescriptor(s,i);if(void 0!==u){if("value"in u)return u.value;var r=u.get;return void 0===r?void 0:r.call(o)}var l=Object.getPrototypeOf(s);if(null===l)return void 0;t=l,e=i,n=o,a=!0}};return{setters:[function(t){a=t["default"]},function(t){s=t["default"]}],execute:function(){i=function(t){function a(){e(this,a);for(var t=arguments.length,n=Array(t),s=0;t>s;s++)n[s]=arguments[s];u(Object.getPrototypeOf(a.prototype),"constructor",this).apply(this,n);var i=this.props.user.suspendUntil(),o=null;new Date>i&&(i=null),i&&(o=9999===i.getFullYear()?"indefinitely":"limited"),this.status=m.prop(o),this.daysRemaining=m.prop("limited"===o&&-moment().diff(i,"days")+1)}return n(a,t),o(a,[{key:"className",value:function(){return"SuspendUserModal Modal--small"}},{key:"title",value:function(){return"冻结用户 "+this.props.user.username()}},{key:"content",value:function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"冻结状态"),m("div",null,m("label",{className:"checkbox"},m("input",{type:"radio",name:"status",checked:!this.status(),onclick:m.withAttr("value",this.status)}),"取消冻结"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"status",checked:"indefinitely"===this.status(),value:"indefinitely",onclick:m.withAttr("value",this.status)}),"永久冻结"),m("label",{className:"checkbox SuspendUserModal-days"},m("input",{type:"radio",name:"status",checked:"limited"===this.status(),value:"limited",onclick:function(e){t.status(e.target.value),m.redraw(!0),t.$(".SuspendUserModal-days-input input").select(),m.redraw.strategy("none")}}),"自定义时间","limited"===this.status()?m("div",{className:"SuspendUserModal-days-input"},m("input",{type:"number",value:this.daysRemaining(),oninput:m.withAttr("value",this.daysRemaining),className:"FormControl"})," 天"):""))),m("div",{className:"Form-group"},s.component({children:"保存更改",className:"Button Button--primary",loading:this.loading}))))}},{key:"onsubmit",value:function(t){var e=this;t.preventDefault(),this.loading=!0;var n=null;switch(this.status()){case"indefinitely":n=new Date("9999-12-31");break;case"limited":n=moment().add(this.daysRemaining(),"days").toDate()}this.props.user.save({suspendUntil:n}).then(function(){return e.hide()},function(){e.loading=!1,m.redraw()})}}]),a}(a),t("default",i)}}});